"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[254],{6108:e=>{e.exports=JSON.parse('{"permalink":"/blog/this-classe-parente","source":"@site/blog/2025-07-23-this-classe-parente.md","title":"En C#, \\"this\\" dans une classe parente ne devient pas le type de l\u2019enfant","description":"Dans mon projet RentCRL, j\u2019ai plusieurs types d\u2019utilisateurs : User, Owner, etc.","date":"2025-05-16T00:00:00.000Z","tags":[],"readingTime":2.205,"hasTruncateMarker":true,"authors":[{"name":"Micka\xebl C\xe9raline","title":"D\xe9veloppeur Full Stack","url":"https://github.com/mickaelcrl","key":"mickael","page":null}],"frontMatter":{"title":"En C#, \\"this\\" dans une classe parente ne devient pas le type de l\u2019enfant","authors":"mickael","date":"2025-05-16T00:00:00.000Z","slug":"/this-classe-parente"},"unlisted":false,"prevItem":{"title":"D\xe9ployer React et .NET sur Azure avec Cosmos DB : g\xe9rer environnements et secrets","permalink":"/blog/deployer-une-application-react-asp-net-core-cosmosdb-azure"},"nextItem":{"title":"RentCRL \u2013 entre Domain Driven Design et minimal API","permalink":"/blog/rentcrl-domain-driven-design-minimal-api"}}')},8453:(e,r,n)=>{n.d(r,{R:()=>t,x:()=>a});var s=n(6540);const i={},l=s.createContext(i);function t(e){const r=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(l.Provider,{value:r},e.children)}},9088:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>a,default:()=>o,frontMatter:()=>t,metadata:()=>s,toc:()=>d});var s=n(6108),i=n(4848),l=n(8453);const t={title:'En C#, "this" dans une classe parente ne devient pas le type de l\u2019enfant',authors:"mickael",date:new Date("2025-05-16T00:00:00.000Z"),slug:"/this-classe-parente"},a=void 0,c={authorsImageUrls:[void 0]},d=[{value:"1 - Ce que j\u2019ai compris",id:"1---ce-que-jai-compris",level:2},{value:"2 - Ce que j\u2019ai chang\xe9",id:"2---ce-que-jai-chang\xe9",level:2},{value:"2.1 - Exemple :",id:"21---exemple-",level:3},{value:"3 - R\xe9sultat",id:"3---r\xe9sultat",level:2},{value:"4 - Conclusion",id:"4---conclusion",level:2}];function u(e){const r={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(r.p,{children:["Dans mon projet ",(0,i.jsx)(r.a,{href:"https://github.com/MickaelCRL/RentCRL",children:"RentCRL"}),", j\u2019ai plusieurs types d\u2019utilisateurs : ",(0,i.jsx)(r.code,{children:"User"}),", ",(0,i.jsx)(r.code,{children:"Owner"}),", etc."]}),"\n",(0,i.jsxs)(r.p,{children:["Comme souvent en test, j\u2019ai voulu faire un ",(0,i.jsx)(r.strong,{children:"builder fluide"})," pour cr\xe9er ces objets proprement."]}),"\n",(0,i.jsxs)(r.p,{children:["J\u2019ai donc commenc\xe9 avec un ",(0,i.jsx)(r.code,{children:"UserBuilder"}),", puis j\u2019ai fait un ",(0,i.jsx)(r.code,{children:"OwnerBuilder"})," qui h\xe9rite de ",(0,i.jsx)(r.code,{children:"UserBuilder"}),", en override la m\xe9thode ",(0,i.jsx)(r.code,{children:"Create()"})," pour retourner un ",(0,i.jsx)(r.code,{children:"Owner"})," au lieu d\u2019un ",(0,i.jsx)(r.code,{children:"User"}),"."]}),"\n",(0,i.jsx)(r.p,{children:"Je pensais que \xe7a suffirait."}),"\n",(0,i.jsx)(r.p,{children:"Mais en cha\xeenant les appels :"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-csharp",children:'var owner = OwnerBuilder.Build()\r\n    .WithEmail("john@example.com")\r\n    .Create();\n'})}),"\n",(0,i.jsxs)(r.p,{children:["Je me suis rendu compte que ",(0,i.jsx)(r.code,{children:"Create()"})," ne retournait pas un ",(0,i.jsx)(r.code,{children:"Owner"}),", mais un ",(0,i.jsx)(r.code,{children:"User"}),"."]}),"\n",(0,i.jsx)(r.h2,{id:"1---ce-que-jai-compris",children:"1 - Ce que j\u2019ai compris"}),"\n",(0,i.jsxs)(r.p,{children:["M\xeame si j\u2019appelais ",(0,i.jsx)(r.code,{children:"Build()"})," sur ",(0,i.jsx)(r.code,{children:"OwnerBuilder"}),", les m\xe9thodes ",(0,i.jsx)(r.code,{children:"WithX()"})," venaient de ",(0,i.jsx)(r.code,{children:"UserBuilder"}),", donc elles retournaient... un ",(0,i.jsx)(r.code,{children:"UserBuilder"}),"."]}),"\n",(0,i.jsxs)(r.p,{children:["Et ",(0,i.jsx)(r.code,{children:"this"})," dans ",(0,i.jsx)(r.code,{children:"UserBuilder"}),", c\u2019est bien le type de la classe de base, ",(0,i.jsxs)(r.strong,{children:["pas celui de la m\xe9thode statique ",(0,i.jsx)(r.code,{children:"Build()"})]}),"."]}),"\n",(0,i.jsxs)(r.p,{children:["Donc toute ma cha\xeene retournait ",(0,i.jsx)(r.code,{children:"UserBuilder"}),", pas ",(0,i.jsx)(r.code,{children:"OwnerBuilder"}),", et au final ",(0,i.jsx)(r.code,{children:"Create()"})," appelait la mauvaise m\xe9thode."]}),"\n",(0,i.jsx)(r.h2,{id:"2---ce-que-jai-chang\xe9",children:"2 - Ce que j\u2019ai chang\xe9"}),"\n",(0,i.jsxs)(r.p,{children:["J\u2019ai refait la structure avec une classe g\xe9n\xe9rique ",(0,i.jsx)(r.code,{children:"UserBuilderGeneric<TBuilder>"}),", et chaque sous-classe (comme ",(0,i.jsx)(r.code,{children:"OwnerBuilder"}),") devait juste impl\xe9menter une m\xe9thode ",(0,i.jsx)(r.code,{children:"GetBuilder()"})," qui retourne ",(0,i.jsx)(r.code,{children:"this"}),", mais typ\xe9e correctement."]}),"\n",(0,i.jsxs)(r.p,{children:["Comme \xe7a, toutes les m\xe9thodes ",(0,i.jsx)(r.code,{children:"WithX()"})," dans la classe de base peuvent retourner ",(0,i.jsx)(r.code,{children:"TBuilder"})," sans faire de cast."]}),"\n",(0,i.jsx)(r.h3,{id:"21---exemple-",children:"2.1 - Exemple :"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-csharp",children:"public abstract class UserBuilderGeneric<TBuilder>\r\n    where TBuilder : UserBuilderGeneric<TBuilder>\r\n{\r\n    protected readonly Fixture _fixture = new();\r\n    protected string _email;\r\n\r\n    protected UserBuilderGeneric()\r\n    {\r\n        _email = _fixture.CreateEmail();\r\n    }\r\n\r\n    protected abstract TBuilder GetBuilder();\r\n\r\n    public TBuilder WithEmail(string email)\r\n    {\r\n        _email = email;\r\n        return GetBuilder();\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-csharp",children:"public class UserBuilder : UserBuilderGeneric<UserBuilder>\r\n{\r\n    protected override UserBuilder GetBuilder() => this;\r\n\r\n    public static UserBuilder Build()\r\n    {\r\n        return new UserBuilder();\r\n    }\r\n\r\n    public override User Create()\r\n    {\r\n        return new User(...);\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-csharp",children:"public class OwnerBuilder : UserBuilderGeneric<OwnerBuilder>\r\n{\r\n    protected override OwnerBuilder GetBuilder() => this;\r\n\r\n    public static OwnerBuilder Build()\r\n    {\r\n        return new OwnerBuilder();\r\n    }\r\n\r\n    public override Owner Create()\r\n    {\r\n        return new Owner(...);\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(r.h2,{id:"3---r\xe9sultat",children:"3 - R\xe9sultat"}),"\n",(0,i.jsx)(r.p,{children:"Je peux maintenant faire :"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-csharp",children:'var owner = OwnerBuilder.Build()\r\n    .WithEmail("john@example.com")\r\n    .Create();\n'})}),"\n",(0,i.jsxs)(r.p,{children:["Et j\u2019ai bien un ",(0,i.jsx)(r.code,{children:"Owner"})," \xe0 la fin, sans avoir \xe0 dupliquer les ",(0,i.jsx)(r.code,{children:"WithX()"})," dans chaque builder, ni faire de cast."]}),"\n",(0,i.jsx)(r.h2,{id:"4---conclusion",children:"4 - Conclusion"}),"\n",(0,i.jsxs)(r.p,{children:["C\u2019est tout b\xeate, mais j\u2019\xe9tais persuad\xe9 que faire un ",(0,i.jsx)(r.code,{children:"override"})," de ",(0,i.jsx)(r.code,{children:"Create()"})," suffisait."]}),"\n",(0,i.jsxs)(r.p,{children:["En fait, non : le ",(0,i.jsx)(r.code,{children:"this"})," dans la classe de base ",(0,i.jsx)(r.strong,{children:"ne suit pas"})," le type de la m\xe9thode ",(0,i.jsx)(r.code,{children:"Build()"})," dans la sous-classe."]}),"\n",(0,i.jsxs)(r.p,{children:["Donc m\xeame si ",(0,i.jsx)(r.code,{children:"Build()"})," retourne un ",(0,i.jsx)(r.code,{children:"OwnerBuilder"}),", la cha\xeene de m\xe9thodes repasse en ",(0,i.jsx)(r.code,{children:"UserBuilder"}),", et ",(0,i.jsx)(r.code,{children:"Create()"})," appelle celle de la classe m\xe8re."]}),"\n",(0,i.jsx)(r.p,{children:"C\u2019est pas r\xe9volutionnaire, mais j\u2019ai trouv\xe9 \xe7a int\xe9ressant \xe0 creuser et \xe7a m\u2019a permis de rendre mes builders plus propres sans copier 10 m\xe9thodes."})]})}function o(e={}){const{wrapper:r}={...(0,l.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}}}]);